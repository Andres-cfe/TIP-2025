// @ts-nocheck
$((function(){"use strict";$("body").addClass("fakeBody");const intentosMaximos=1/0,maxScore=80,question=5;let intento=course360.getLessonLocation();Number.isNaN(Number(intento))?(console.error("El valor de intento no es un número válido."),intento=0):(intento=Number(intento),intento>intentosMaximos&&(intento=0,course360.setLessonLocation(intento)),console.log("El valor de intento es un número válido:",intento));const audio_instrucciones=course360.createSound("audio/audio_h31.mp3"),audio_inicio=course360.createSound("audio/audio_h30.mp3"),bad=course360.createSound("audio/feedback-incorrect.mp3"),good=course360.createSound("audio/feedback-correct.mp3"),slidesound=course360.createSound("audio/slide.mp3");function readExcelFile(e,o){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(e){var n=t.response,r=new Uint8Array(n),s=XLSX.read(r,{type:"array"}),a={};s.SheetNames.forEach((e=>{var o=s.Sheets[e];a[e]=XLSX.utils.sheet_to_json(o)})),o(a)},t.send()}function procesarPreguntas(e){return e.map((e=>{const o=[];return Object.keys(e).forEach((t=>{t.startsWith("opcion")&&o.push({text:e[t].trim(),correct:"opcion_c"===t})})),{pregunta:e.pregunta.trim(),opciones:shuffleArray(o),retroalimentacion_correcta:e.retro_bien.trim(),retroalimentacion_incorrecta:e.retro_mal.trim()}}))}function shuffleArray(e){for(let o=e.length-1;o>0;o--){const t=Math.floor(Math.random()*(o+1));[e[o],e[t]]=[e[t],e[o]]}return e}let questions,preguntas;audio_inicio.on("end",(function(){$(".ins0").show(),$(".btn-comenzar").addClass("animate__animated animate__pulse animate__infinite waves-effect").removeClass("disabled")})),audio_instrucciones.on("end",(function(){$("#paso1").removeClass("disabled"),$(".object_handler").removeClass("disabled"),clickHandlerQuestion(),/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)})),intento>=intentosMaximos?Swal.fire({icon:"error",title:"¡Límite de intentos alcanzado!",html:`\n                  <p>Has alcanzado el límite de intentos.</p>\n                  <p><strong>Intentos realizados:</strong> ${intento}</p>\n                  <p><strong>Intentos permitidos:</strong> ${intentosMaximos}</p>\n                `,confirmButtonText:"Aceptar"}).then((()=>{course360.resetCourse()})):course360.audioController.stopAllSoundsAndPlay(audio_inicio),$(".btn-comenzar").click((function(){intento++,course360.setLessonLocation(intento),$("#inicio").hide(),$("#desarrollo").show(),$("body").addClass("fakeBodyDesarrollo"),course360.audioController.stopAllSoundsAndPlay(audio_instrucciones)}));let currentQuestionIndex=0,currentQuestion,correctAnswer,counterCorrectQuestions=0;function renderQuestion(){$("#pregunta").html("");document.getElementById("pregunta").innerHTML=`<div class="wtext py-md-4 py-2 fw-bold animate__animated animate__flipInX text-primary">${currentQuestion.pregunta}</div>\n        <div class="w-100 text-center">\n          <div class="options justify-content-center animate__animated animate__flipInX"></div>\n        </div>`,$(".option").html(""),$(".options").html(""),renderOptions(currentQuestion),handlerOptionClick(),course360.audioController.stopAllSoundsAndPlay(slidesound)}function renderOptions(e){const o=document.querySelector(".options"),t=e.opciones.map(((e,o)=>`\n                    <div class="option" data-correct="${e.correct}">\n                        <div class="letter bree fw-bold text-white">${String.fromCharCode(97+o)}</div><div class="option-text">${e.text.trim()}</div>\n                    </div>\n                `)).join("");o.innerHTML=t,Pop()}function handlerOptionClick(){currentQuestionIndex++,$(".options").find(".option").on("click",(function(){if(course360.soundClick(),$(".options").addClass("disabled"),!0===$(this).data("correct")){course360.audioController.stopAllSoundsAndPlay(good);const e="correcto",o=`\n                        <div class="text-center">\n                            <h1 class="text-primary text-center fw-bold">¡Correcto!</h1>\n                            <p class="mt-3">${currentQuestion.retroalimentacion_correcta}</p>\n                        </div>`;counterCorrectQuestions++,updateBackgrpund(!0),Swal.fire({html:o,customClass:e,showConfirmButton:!1,showCloseButton:!0,didClose:()=>{},backdrop:"rgba(0, 0, 0, 0.9)",didDestroy:()=>{IsComplete()}})}else{course360.audioController.stopAllSoundsAndPlay(bad),updateBackgrpund(!1);const e="incorrecto",o=`\n                        <div class="text-center">\n                            <h1 class="text-primary text-center fw-bold">¡Incorrecto!</h1>\n                            <p class="mt-3">${currentQuestion.retroalimentacion_incorrecta}</p>\n                        </div>`;Swal.fire({html:o,customClass:e,showConfirmButton:!1,showCloseButton:!0,didClose:()=>{},backdrop:"rgba(0, 0, 0, 0.9)",didDestroy:()=>{IsComplete()}})}}))}function nextQuestion(e){$(".option").removeClass("disabled"),currentQuestionIndex>=questions.length?setTimeout(showFinal,500):(currentQuestion=questions[currentQuestionIndex],correctAnswer=currentQuestion.opciones[0].text.toUpperCase(),setTimeout(renderQuestion,e))}function IsComplete(){$(".personaje").removeClass("animate__animated animate__slideInLeft"),$(".paso").length===$(".paso.visited").length?setTimeout(showFinal,500):$(".paso.visited").next().removeClass("disabled")}readExcelFile("preguntas_actividad_m1_Manejo_a_la_defensiva.xlsx",(function(e){const o=e.quiz;preguntas=procesarPreguntas(o),questions=shuffleArray(preguntas),currentQuestion=questions[currentQuestionIndex],correctAnswer=currentQuestion.opciones[0].text.toUpperCase()})),$(".paso").click((function(){$(".card-form").hide(),$(this).removeClass("animate__animated animate__pulse animate__infinite").addClass("visited");const sound=eval($(this).data("audio")),pasoIndex=parseInt($(this).data("paso"));$(this).css("opacity",0),$(".personaje").removeClass("active animate__animated animate__slideInLeft"),$(".personaje").eq(pasoIndex).addClass("active animate__animated animate__slideInLeft").one("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",(function(){nextQuestion()}))}));let correctBackgroundIndex=1,incorrectBackgroundIndex=1;function updateBackgrpund(e){const o=document.querySelector("body");o.classList.remove("background-correct-1","background-correct-2","background-correct-3","background-correct-4","background-correct-5","background-incorrect-1","background-incorrect-2","background-incorrect-3","background-incorrect-4","background-incorrect-5"),e?(o.classList.add(`background-correct-${correctBackgroundIndex}`),correctBackgroundIndex=correctBackgroundIndex%5+1):(o.classList.add(`background-incorrect-${incorrectBackgroundIndex}`),incorrectBackgroundIndex=incorrectBackgroundIndex%5+1)}function Pop(){Swal.fire({html:$("#pregunta").html(),target:"body",customClass:"question-class-pop",showConfirmButton:!1,showCancelButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,didOpen:()=>{},willClose:()=>{course360.audioController.stopAudio()}})}function clickHandlerQuestion(){$(".object_handler").click((function(){$(this).addClass("selected_object"),$(".card-question").show(),nextQuestion()}))}const audioExcelente=course360.createSound("audio/audio_h32.mp3"),audioSorry=course360.createSound("audio/audio_h33.mp3"),audioIntentos=course360.createSound("audio/audio_h33.mp3");function showFinal(){$("#desarrollo").hide(),$("#cierre").show();const e=Math.round(100*counterCorrectQuestions/question);e>=maxScore?($("body").addClass("fakeBodyCierreGood"),$("#retrotxt").html('<h2 class="fw-bold text-primary text-center"> ¡Excelente trabajo! </h2><p class="text-center">Has demostrado un dominio extraordinario del manejo a la defensiva.</p><p class="fw-bold">¡Tu camino es claro y seguro!</p>'),$(".score80mas").show(),$(".score80menos").hide(),$(".intentos").hide(),course360.setSlideVisited(),course360.audioController.stopAllSoundsAndPlay(audioExcelente),course360.setScore(e),course360.setLessonStatus("completed"),course360.save()):intento>=intentosMaximos?($("#retrotxt").html('<h1 class="fw-bold text-primary text-center"></h1><p class="text-center">Revisa nuevamente el contenido y responde la evaluación cuando estés preparado.</p>'),$(".score80mas").hide(),$(".score80menos").hide(),$(".intentos").show(),course360.setLessonLocation(0),course360.audioController.stopAllSoundsAndPlay(audioIntentos)):($("body").addClass("fakeBodyCierreBad"),$("#retrotxt").html('<h1 class="fw-bold text-primary text-center">Aún puedes mejorar.</h1><p class="text-center">Algunas decisiones en el camino no fueron las mejores, pero puedes volver a intentarlo.</p><p class="fw-bold">¡Toma el volante otra vez y demuestra lo que sabes!</p>'),$(".score80mas").hide(),$(".score80menos").show(),$(".intentos").hide(),course360.audioController.stopAllSoundsAndPlay(audioSorry)),course360.save()}function ratingGraph(e){const o=new ProgressBar.Circle("#progress-container",{color:"#FFEA82",trailColor:"#eee",trailWidth:7,duration:1400,easing:"bounce",strokeWidth:14,from:{color:"#d33266",a:0},to:{color:"#e2688e",a:1},step:function(e,o){o.path.setAttribute("stroke",e.color)}});if(e<0||e>100)return void console.error("El valor debe estar entre 0 y 100.");o.animate(e/100);const t=document.querySelector(".progress-text")||document.createElement("div");t.className="progress-text",t.innerText=e+"%",document.querySelector(".progress-text")||document.getElementById("progress-container").appendChild(t)}}));